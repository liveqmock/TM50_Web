\ufeff###########################################################################
# \uc791\uc131\uc790 : \uae40\uc720\uadfc
# \ucd5c\ucd08\uc791\uc131\uc77c : 2008-03-04
# \uc6a9\ub3c4 : \ub300\uc0c1\uc790  \uad00\ub828 \ucffc\ub9ac \uc815\ubcf4 (\ubc18\ub4dc\uc2dc \uc5b4\ub4dc\ubbfc\uc5d0 \uad00\ub828\ub41c \ucffc\ub9ac\ub9cc \uc785\ub825\ud574\uc57c \ud568!)
# \uc791\uc131 : \uba54\uc778\ud328\ud0a4\uc9c0\uba85.\uc11c\ube0c\ud328\ud0a4\uc9c0\uba85.\ucffc\ub9ac\uc6a9\ub3c4
# ex) : bixon.web.admin \ud328\ud0a4\uc9c0\uc548\uc5d0 board\ud328\ud0a4\uc9c0\uc548\uc5d0 \uc0ac\uc6a9\ub418\ub294 insert\uc6a9\ub3c4\uc758 \ucffc\ub9ac\ubb38\uc774\ub77c\uba74 \uc544\ub798\ucc98\ub7fc \uad6c\ud604\ud55c\ub2e4.
# admin.board.insert=insert into board(title,content) values(?,?)
# \uacbd\uace0 : \ubc18\ub4dc\uc2dc SQL\ubb38\uc740 ANSI SQL\ubb38\uc73c\ub85c \uc791\uc131\ud560 \uac83!!!
###########################################################################

###########\ub300\ub7c9\uba54\uc77c\uc791\uc131##################

#\uac00\uc7a5\ucd5c\uadfc\uc5d0 \uc785\ub825\ub41c massmailID\ub97c \uac00\uc838\uc628\ub2e4.
massmail.write.selectmassmailid=SELECT MAX(massmailID) massmailID FROM tm_massmail_info 

#\uc785\ub825\uc815\ubcf4\ubcf4\uae30
massmail.write.viewmassmailinfo=SELECT i.massmailID, i.massmailGroupID, i.massmailTitle, i.description,i.sendType, i.statisticsType,  \
						i.statisticsOpenType, i.repeatSendType, i.repeatSendWeek, i.repeatSendDay, i.memo, i.userID, u.userName, (select groupID from tm_users where userID = i.userID) as groupID, i.approveUserID, i.approveDate, i.priority, m.receiverName, m.mailTitle, \
						m.senderMail, m.senderName, m.returnMail, m.encodingType, m.mailType, m.mailContent, m.mailLinkYN, m.webURL, m.webURLType, m.pollID,i.repeatSendStartDate, i.repeatSendEndDate, datename(hh,i.repeatSendStartDate) repeatSendTimeHH, datename(mi,i.repeatSendStartDate) repeatSendTimeMM, \
						f.duplicationYN,f.persistErrorCount, f.rejectType, f.sendedCount, f.sendedMonth, f.sendedType, f.sendedYear, s.scheduleID, s.sendScheduleDate, datename(hh,s.sendScheduleDate) sendScheduleDateHH, datename(mi,s.sendScheduleDate)sendScheduleDateMM, \
						m.fileNames, m.filePath \
						FROM tm_massmail_info i INNER JOIN tm_users u ON i.approveUserID=u.userID \
						INNER JOIN tm_massmail_schedule s ON i.massmailID=s.massmailID \
						INNER JOIN tm_massmail_mail m ON i.massmailID=m.massmailID \
						INNER JOIN tm_massmail_filterset f ON i.massmailID=f.massmailID  WHERE i.massmailID=:massmailID AND s.scheduleID=:scheduleID

#\uae30\ubcf8\uc815\ubcf4\uc785\ub825
massmail.write.insertmassmailinfo=INSERT INTO tm_massmail_info(massmailGroupID,massmailTitle,description,userID,sendType,statisticsType,statisticsOpenType,repeatSendType, repeatSendStartDate, repeatSendEndDate, repeatSendDay,repeatSendWeek,approveUserID,memo,priority,registDate) \
						VALUES(:massmailGroupID, :massmailTitle, :description, :userID, :sendType, :statisticsType, :statisticsOpenType, :repeatSendType, :repeatSendStartDate, :repeatSendEndDate, :repeatSendDay, :repeatSendWeek, :approveUserID, :memo,:priority, getDate())						


#\ub300\uc0c1\uadf8\ub8f9\uc785\ub825
massmail.write.inserttargetgroup=INSERT INTO tm_massmail_targetgroup(massmailID, targetID, targetName, targetType, dbID, queryText, targetCount, exceptYN, registDate) \
						SELECT :massmailID, targetID, targetName, targetType, dbID, queryText, targetCount, :exceptYN, getDate() FROM tm_target_list WHERE targetID=:targetID
#\uc2a4\ucf00\uc904\uc785\ub825
massmail.write.insertschedule=INSERT INTO tm_massmail_schedule(massmailID,scheduleID, sendScheduleDate, statisticsEndDate, state, targetTotalCount, registDate) VALUES(:massmailID, :scheduleID, :sendScheduleDate, :statisticsEndDate, :state, :targetTotalCount, getDate())

#\ud544\ud130\ub9c1\uc785\ub825
massmail.write.insertfilterset=INSERT INTO tm_massmail_filterset(massmailID, duplicationYN, sendedType, sendedYear, sendedMonth, sendedCount, rejectType, persistErrorCount, registDate) \
				VALUES(:massmailID, :duplicationYN, :sendedType, :sendedYear, :sendedMonth, :sendedCount, :rejectType, :persistErrorCount, getDate())
#\uba54\uc77c\uc785\ub825 
massmail.write.insertmail=INSERT INTO tm_massmail_mail(massmailID,senderName,senderMail,receiverName,returnMail,encodingType,mailType,mailTitle,mailContent,webURL,webURLType,pollID,mailLinkYN,registDate, fileNames, filePath) \
						 VALUES(:massmailID,:senderName,:senderMail,:receiverName,:returnMail,:encodingType,:mailType,:mailTitle,:mailContent,:webURL,:webURLType,:pollID,:mailLinkYN,getDate(), :fileNames, :filePath)

#\uba54\uc77c\ub9c1\ud06c\uc785\ub825
massmail.write.insertlink=INSERT INTO tm_massmail_link(massmailID, linkName, linkURL, linkCount, linkType, linkDesc, useYN, registDate) VALUES(:massmailID, :linkName, :linkURL,  :linkCount, :linkType, :linkDesc, :useYN, getDate())
massmail.write.selectmaillink=SELECT linkID, massmailID, linkName, linkURL, linkCount, linkDesc, linkType FROM tm_massmail_link WHERE massmailID=:massmailID
massmail.write.updatemaillinkall=UPDATE tm_massmail_link SET linkType='1' WHERE massmailID=:massmailID
massmail.write.updatemaillinktype=UPDATE tm_massmail_link SET linkType=:linkType WHERE linkID=:linkID
###########\ub300\ub7c9\uba54\uc77c\ub9ac\uc2a4\ud2b8 ##############
massmail.write.select=SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY s.sendScheduleDate  desc) AS RN, m.massmailID, m.massmailGroupID, m.massmailTitle, m.sendType, m.approveUserID, s.sendScheduleDate, s.scheduleID, s.sendStartTime, s.sendEndTime, s.targetTotalCount, s.sendTotalCount, s.state, a.pollID, m.userID, u.userName, u.groupID, g.groupName, m.priority ,s.registDate, \
				(SELECT ISNULL(SUM(successTotal),-1) FROM tm_massmail_domainstatistic d WHERE s.massmailID = d.massmailID AND s.scheduleID = d.scheduleID) as successTotal \
				FROM tm_massmail_info m INNER JOIN tm_massmail_schedule s ON m.massmailID = s.massmailID \
				INNER JOIN tm_massmail_mail a ON a.massmailID = m.massmailID \
				INNER JOIN tm_users u ON m.userID=u.userID INNER JOIN tm_usergroup g ON u.groupID=g.groupID WHERE s.deleteYN='N'
massmail.write.selecttail=\ ) AS A  WHERE RN BETWEEN :start+1  AND :countPerPage+:start
massmail.write.totalcountmassmaillist=SELECT COUNT(*) \
				FROM tm_massmail_info m INNER JOIN tm_massmail_schedule s ON m.massmailID = s.massmailID \
				INNER JOIN tm_massmail_mail a ON a.massmailID = m.massmailID \
				INNER JOIN tm_users u ON m.userID=u.userID INNER JOIN tm_usergroup g ON u.groupID=g.groupID WHERE s.deleteYN='N' 
massmail.write.selecttester=SELECT testerEmail, testerName FROM tm_massmail_tester WHERE userID=:userID
massmail.write.target=SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY t.registDate desc) AS RN, t.targetID, t.userID, t.targetName, t.queryText, t.targetType, t.targetCount, t.dbID,u.userName, u.groupID, g.groupName \
				FROM tm_target_list t INNER JOIN tm_users u ON t.userID = u.userID INNER JOIN tm_usergroup g ON u.groupID=g.groupID \
				WHERE t.state='3' AND bookMark != 'D'  AND t.targetID IN(SELECT DISTINCT(targetID) FROM tm_onetoone_target WHERE onetooneID='1')
massmail.write.expecttargetcount=SELECT SUM(targetCount) FROM tm_massmail_targetgroup WHERE massmailID=:massmailID  and exceptYN='N'
massmail.write.targettail=\ ) AS A  WHERE RN BETWEEN :start+1  AND :countPerPage+:start
massmail.write.totalcount=SELECT COUNT(*)  FROM tm_target_list t INNER JOIN tm_users u ON t.userID = u.userID INNER JOIN tm_usergroup g ON u.groupID=g.groupID WHERE t.state IN('3') 
massmail.write.updatemassmailinfo=UPDATE tm_massmail_info SET massmailGroupID=:massmailGroupID,massmailTitle=:massmailTitle,description=:description,modifyUserID=:modifyUserID,modifyDate=getDate(), sendType=:sendType, \
						statisticsType=:statisticsType,statisticsOpenType=:statisticsOpenType,repeatSendType=:repeatSendType, repeatSendDay=:repeatSendDay,repeatSendWeek=:repeatSendWeek, \
						approveUserID=:approveUserID,memo=:memo,priority=:priority  WHERE massmailID=:massmailID
massmail.write.updateapprovedate=UPDATE tm_massmail_info SET approveDate=getDate() WHERE massmailID=:massmailID
massmail.write.updatefilterset=UPDATE tm_massmail_filterset SET sendedType=:sendedType, sendedYear=:sendedYear, sendedMonth=:sendedMonth, sendedCount=:sendedCount, rejectType=:rejectType, persistErrorCount=:persistErrorCount, duplicationYN=:duplicationYN WHERE massmailID=:massmailID
massmail.write.updatemail=UPDATE tm_massmail_mail SET senderName=:senderName,senderMail=:senderMail,receiverName=:receiverName,returnMail=:returnMail,encodingType=:encodingType,mailType=:mailType,mailTitle=:mailTitle,mailContent=:mailContent,webURL=:webURL,webURLType=:webURLType, mailLinkYN=:mailLinkYN, pollID=:pollID,registDate=getDate(), fileNames=:fileNames, filePath=:filePath \
						  WHERE massmailID=:massmailID
massmail.write.viewmailcontent=SELECT mailContent,encodingType FROM tm_massmail_mail WHERE massmailID=:massmailID
#\ub300\uc0c1\uc790\uadf8\ub8f9
massmail.write.selecttargetgroup=SELECT targetGroupID, massmailID, targetID, targetName, targetType, targetCount, exceptYN FROM tm_massmail_targetgroup WHERE massmailID=:massmailID
#\ub300\uc0c1\uc790\uadf8\ub8f9
massmail.write.selecttargetgroupids=SELECT  targetID, targetName, targetType, targetCount FROM tm_target_list
 #\uae30\ubcf8\uc815\ubcf4\uc0ad\uc81c
massmail.write.deletemassmailinfo=DELETE FROM tm_massmail_info WHERE massmailID=:massmailID
#\ub300\uc0c1\uadf8\ub8f9\uc0ad\uc81c 
massmail.write.deletetargetgroup=DELETE FROM tm_massmail_targetgroup WHERE massmailID=:massmailID
#\ud544\ud130\uc124\uc815\uc0ad\uc81c
massmail.write.deletefilterset=DELETE FROM tm_massmail_filterset WHERE massmailID=:massmailID
#\ud544\ud130\ub9c1\uc0ad\uc81c
massmail.write.deletefiltering=DELETE FROM tm_massmail_filter WHERE massmailID=:massmailID AND scheduleID=:scheduleID
#\uc2a4\ucf00\uc904\uc0ad\uc81c
massmail.write.deleteschedule=DELETE FROM tm_massmail_schedule WHERE massmailID=:massmailID
#\ub300\ub7c9\uba54\uc77c \uc0ad\uc81c (deleteYN = 'Y')
massmail.write.updatedeleteyn=UPDATE tm_massmail_schedule set deleteYN='Y' WHERE massmailID=:massmailID
#\uba54\uc77c\uc815\ubcf4\uc0ad\uc81c
massmail.write.deletemail=DELETE FROM tm_massmail_mail WHERE massmailID=:massmailID
#\uba54\uc77c\ub9c1\ud06c\uc0ad\uc81c
massmail.write.deletemaillink=DELETE FROM tm_massmail_link WHERE massmailID=:massmailID
#\ub9c1\ud06c\ud074\ub9ad\uc0ad\uc81c
massmail.write.deletelinkclick=DELETE FROM tm_massmail_linkclick WHERE massmailID=:massmailID AND scheduleID=:scheduleID
#\ub3c4\uba54\uc778\ud1b5\uacc4\uc0ad\uc81c
massmail.write.deletedoaminstatistic=DELETE FROM tm_massmail_domainstatistic WHERE massmailID=:massmailID AND scheduleID=:scheduleID
#\uc2e4\ud328\ud1b5\uacc4\uc0ad\uc81c
massmail.write.deletefailstatistic=DELETE FROM tm_massmail_failstatistic WHERE massmailID=:massmailID AND scheduleID=:scheduleID
#\uc2dc\uac04\ubcc4\ud1b5\uacc4
massmail.write.deletetimestatistic=DELETE FROM tm_massmail_timestatistic WHERE massmailID=:massmailID AND scheduleID=:scheduleID

#\uc2dc\uc2a4\ud15c\uba54\uc77c\uc785\ub825
massmail.write.insertnotifyemail=INSERT INTO tm_system_notify(notifyFlag, notifyType, userID, senderMail, senderName, receiverMail, receiverName, returnMail, mailTitle, mailContent, registDate, fileNames, filePath) \
				VALUES(:notifyFlag, :notifyType, :userID,:senderMail, :senderName, :receiverMail, :receiverName, :returnMail,:mailTitle, :mailContent, getDate(), :fileNames, :filePath)
#\uc2dc\uc2a4\ud15c\uba54\uc77c\uc0ad\uc81c
massmail.write.deletenotifyemail=DELETE FROM tm_system_notify WHERE notifyID IN (
#\ub300\uc0c1\uc790\uadf8\ub8f9\uc870\ud68c
massmail.write.getcounttargetID=SELECT COUNT(*)  FROM tm_massmail_targetgroup WHERE massmailID=:massmailID AND targetID=:targetID
#\ud658\uacbd\uc124\uc815\ud68c
massmail.systemset.selectconfigvalue= SELECT configValue FROM tm_config WHERE configFlag=:configFlag AND configName=:configName
massmail.write.updatemailcontent=UPDATE tm_massmail_mail SET mailContent=:mailContent WHERE massmailID=:massmailID
#\uba54\uc77c\ub9c1\ud06c\uc0ad\uc81c
massmail.write.deletelinkbyid=DELETE FROM tm_massmail_link WHERE massmailID=:massmailID AND 
massmail.write.updateallschedulestate=UPDATE tm_massmail_schedule SET state=:state WHERE massmailID=:massmailID
massmail.write.selecttargetquery=SELECT t.queryText, j.driverType, j.driverClass, d.dbID, d.dbURL, d.dbUserID, d.dbUserPWD FROM tm_target_list t INNER JOIN tm_dbset d ON t.dbID=d.dbID INNER JOIN tm_jdbcset j ON d.driverID=j.driverID WHERE targetID=:targetID
massmail.write.viewonetoonetarget=SELECT o.onetooneAlias, t.fieldName FROM tm_onetoone o INNER JOIN tm_onetoone_target t ON o.onetooneID = t.onetooneID \
								WHERE t.targetID = :targetID order by t.onetooneID	
massmail.write.selectnotify=SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY registDate desc) AS RN, notifyID, userID, receiverMail, mailTitle, wasSended, smtpResult, smtpCode, smtpMsg, registDate FROM tm_system_notify WHERE  notifyFlag=:notifyFlag AND notifyType='1' AND userID=:userID 
massmail.write.selectnotifytail=\ ) AS A  WHERE RN BETWEEN :start+1  AND :countPerPage+:start
massmail.write.totalcountnotify=SELECT COUNT(*) FROM tm_system_notify WHERE notifyFlag=:notifyFlag AND notifyType='1' AND userID=:userID
massmail.write.selectonetoone=SELECT o.onetooneName, o.onetooneAlias FROM tm_onetoone o INNER JOIN tm_onetoone_target t ON o.onetooneID=t.onetooneID 
#\uc804\uccb4\uc0ac\uc6a9\uc790
massmail.write.selecttemplate=SELECT t.templateID, t.templateName, t.templateContent, t.userID, u.userName , t.templateType FROM tm_massmail_templates t LEFT OUTER JOIN tm_usergroup g ON t.shareGroupID=g.groupID \
					INNER JOIN tm_users u ON u.userID=t.userID  WHERE t.useYN='Y' AND (t.templateType=:templateType OR t.templateType='4')
#\uadf8\ub8f9\uad00\ub9ac\uc790
massmail.write.selecttemplatebygroup= AND (t.shareGroupID='ALL') OR (t.shareGroupID=:groupID) OR (t.shareGroupID='NOT' AND u.groupID=:groupID)
#\uc77c\ubc18\uc0ac\uc6a9\uc790
massmail.write.selecttemplatebyuser= AND (t.shareGroupID='ALL') OR (t.shareGroupID=:groupID) OR (t.shareGroupID='NOT' AND u.userID=:userID)
massmail.write.templatetail=\ ORDER BY t.usedCount DESC 
massmail.write.viewtemplate=SELECT templateID, templateName, templateContent FROM tm_massmail_templates WHERE templateID=:templateID
massmail.write.updatetemplatecount=UPDATE tm_massmail_templates SET usedCount=usedCount+1 WHERE templateID=:templateID
#\ucca8\ubd80\ud30c\uc77c\uc870\ud68c
massmail.write.selectattachedfile=SELECT fileKey, fileSize, fileName, filePath, fileSize, registDate, sendedDate, fileSizeByte FROM tm_massmail_file WHERE userID=:userID ORDER BY registDate DESC 
#\ucca8\ubd80\ud30c\uc77c\uc0bd\uc785
massmail.write.insertattachedfile=INSERT INTO tm_massmail_file(userID, fileName, fileKey, filePath, fileSize, registDate, fileSizeByte) VALUES(:userID, :fileName, :fileKey, :filePath, :fileSize, getDate(), :fileSizeByte)
#\ucca8\ubd80\ud30c\uc77c\uc5c5\ub370\uc774\ud2b8 
massmail.write.updateattachedfile=UPDATE tm_massmail_file SET massmailID=:massmailID WHERE fileKey IN (
#\ucca8\ubd80\ud30c\uc77c\uc0ad\uc81c
massmail.write.deleteattachedfile=DELETE FROM tm_massmail_file WHERE fileKey IN (
#\ucca8\ubd80\ud30c\uc77c\uc815\ubcf4 \uac00\uc838\uc624\uae30
massmail.write.getattachedfile=SELECT fileName, fileKey, fileSize FROM tm_massmail_file WHERE fileKey=:fileKey
#\uc774\ubbf8\uc9c0 \uc5c5\ub85c\ub4dc
massmail.write.insertimagefile=INSERT INTO tm_massmail_image(userID, fileName, fileKey, filePath, fileSize, registDate) VALUES(:userID, :fileName, :fileKey, :filePath, :fileSize, getDate())
#\uc774\ubbf8\uc9c0 \ub9ac\uc2a4\ud2b8
massmail.write.selectimagefile=SELECT fileKey, fileSize, fileName, filePath, registDate FROM tm_massmail_image WHERE userID=:userID ORDER BY registDate DESC
#\uc774\ubbf8\uc9c0 \uc0ad\uc81c
massmail.write.deleteimagefile=DELETE FROM tm_massmail_image WHERE fileKey IN (
#\uac19\uc740 \uc774\ub984 \uc774\ubbf8\uc9c0 \uc788\ub294\uc9c0 \ud655\uc778
massmail.write.getimagefile=select fileKey, fileSize, fileName, filePath, registDate from tm_massmail_image where fileName = :fileName and userID =:userID 

#\ubcf4\ub0b4\ub294\uc0ac\ub78c\ub9ac\uc2a4\ud2b8
massmail.write.selectsender=SELECT s.senderName, s.senderEmail FROM tm_sender s INNER JOIN tm_users u ON s.userID = u.userID WHERE s.useYN='Y' AND  ( (s.shareType='3') OR (s.shareType='2' AND u.groupID=:groupID) OR (s.shareType='1' AND u.userID=:userID) )

###########\ubc18\ubcf5\uba54\uc77c\uad00\ub9ac##################
massmail.write.selectrepeatmail=SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY i.registDate desc) AS RN, i.massmailID, i.massmailTitle, u.userName, i.repeatSendType, i.repeatSendStartDate, i.repeatSendEndDate FROM tm_massmail_info i \
						INNER JOIN tm_users u ON i.userID=u.userID INNER JOIN tm_usergroup g ON u.groupID=g.groupID WHERE i.sendType='3' 
massmail.write.selectrepeatmailtail=\ ) AS A  WHERE RN BETWEEN :start+1  AND :countPerPage+:start
massmail.write.totalrepeatmail=SELECT COUNT(*) FROM tm_massmail_info i INNER JOIN tm_users u ON i.userID=u.userID INNER JOIN tm_usergroup g ON u.groupID=g.groupID WHERE i.sendType='3'
massmail.write.viewrepeatmassmail=SELECT massmailID, massmailTitle, userID, repeatSendType, repeatSendWeek, repeatSendDay,  repeatSendStartDate, repeatSendEndDate FROM tm_massmail_info WHERE massmailID=:massmailID
massmail.write.selectrepeatschedule=SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY sendScheduleDate) AS RN, massmailID, scheduleID, sendScheduleDate, sendStartTime, state FROM tm_massmail_schedule WHERE massmailID=:massmailID
massmail.write.selectrepeatscheduletail=\ ) AS A  WHERE RN BETWEEN :start+1  AND :countPerPage+:start
massmail.write.totalrepeatschedule=SELECT COUNT(*) FROM tm_massmail_schedule WHERE massmailID=:massmailID
massmail.write.deleteschedulebychecked=DELETE FROM tm_massmail_schedule WHERE massmailID=:massmailID AND state IN('11') AND scheduleID IN (
massmail.write.deleteschedulebydate=DELETE FROM tm_massmail_schedule WHERE massmailID=:massmailID AND state IN('11') AND sendScheduleDate>=:fromDate AND sendScheduleDate<=:toDate 
massmail.write.updaterepeatenddate=UPDATE tm_massmail_info SET repeatSendEndDate=(select TOP 1 sendScheduleDate from tm_massmail_schedule where massmailID=:massmailID ORDER BY scheduleID desc) WHERE massmailID=:massmailID
massmail.write.checkmasmailschedule=SELECT COUNT(*) FROM tm_massmail_schedule WHERE massmailID=:massmailID
massmail.write.updateState=UPDATE tm_massmail_schedule SET state=:state WHERE massmailID=:massmailID AND scheduleID=:scheduleID
#\ubc31\uc5c5 \ud14c\uc774\ube14 \ud655\uc778 
massmail.statistic.backupyearmonth=SELECT backupYearMonth FROM tm_massmail_schedule WHERE massmailID=:massmailID AND scheduleID=:scheduleID 
#\ub9c1\ud06c\ubd84\uc11d
massmail.statistic.link = SELECT linkID, scheduleID, linkName, linkURL, SUM(linkCount) as linkCount, linkDesc, linkType \
                               FROM \
                               ( SELECT  A.linkID, B.scheduleID, A.linkName,  A.linkURL, count(DISTINCT B.email) as linkCount, A.linkDesc, A.linkType \
                               		  FROM tm_massmail_link A left outer join tm_massmail_linkclick B ON A.linkID = B.linkID AND B.scheduleID=:scheduleID \
                               		  WHERE A.massmailID=:massmailID  \
                               		  GROUP BY A.linkID, B.email , B.scheduleID, A.linkName, A.linkURL, A.linkDesc, A.linkType \
                               ) C \
                               GROUP BY C.linkID , scheduleID, linkName, linkURL, linkDesc, linkType 
                               			
#\uc2dc\uac04\ubcc4 \ud1b5\uacc4
massmail.statistic.hourly = SELECT hourDate, sendCount, successCount, failCount, openCount, clickCount, rejectcallCount, CASE successCount WHEN 0 THEN 0 ELSE (successCount / sendCount) * 100 END successRatio \
							FROM ( \
								SELECT hourDate, SUM(sendCount) sendCount,  SUM(successCount) successCount, SUM(failCount) failCount, SUM(openCount) openCount, SUM(clickCount) clickCount, SUM(rejectcallCount) rejectcallCount \
								FROM tm_massmail_timestatistic \
								WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
								GROUP BY hourDate \
							) A
#\uc77c\uc790\ubcc4 \ud1b5\uacc4
massmail.statistic.daily = SELECT dayDate, sendCount, successCount, failCount, openCount, clickCount, rejectcallCount, CASE successCount WHEN 0 THEN 0 ELSE (successCount / sendCount) * 100 END successRatio \
							FROM ( \
								SELECT dayDate, SUM(sendCount) sendCount,  SUM(successCount) successCount, SUM(failCount) failCount, SUM(openCount) openCount, SUM(clickCount) clickCount, SUM(rejectcallCount) rejectcallCount \
								FROM tm_massmail_timestatistic \
								WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
								GROUP BY dayDate \
							) A
							
#\ub3c4\uba54\uc778\ubcc4 \ud1b5\uacc4
massmail.statistic.domain = SELECT TOP 20 lower(domainName) AS domainName, sendTotal, successTotal, failTotal, openTotal, clickTotal, rejectcallTotal, CASE successTotal WHEN 0 THEN 0 ELSE (successTotal / sendTotal) * 100 END successRatio \
							FROM( \
								SELECT domainName, SUM(sendTotal) sendTotal, SUM(successTotal) successTotal, SUM(failTotal) failTotal, SUM(openTotal) openTotal, SUM(clickTotal) clickTotal, SUM(rejectcallTotal) rejectcallTotal \
								FROM tm_massmail_domainstatistic \
								WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
								GROUP BY domainName \
							) A  ORDER BY sendTotal DESC 
							
#\ub300\uc0c1\uc790\ubcc4 \ud1b5\uacc4
massmail.statistic.target = SELECT targetName, sendTotal, successTotal, failTotal, openTotal, clickTotal, rejectcallTotal, CASE successTotal WHEN 0 THEN 0 ELSE (successTotal / sendTotal) * 100 END successRatio \
							FROM( \
							SELECT targetName, SUM(sendTotal) sendTotal, SUM(successTotal) successTotal, SUM(failTotal) failTotal, SUM(openTotal) openTotal, SUM(clickTotal) clickTotal, SUM(rejectcallTotal) rejectcallTotal \
							FROM tm_massmail_targetstatistic \
							WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
							GROUP BY targetName \
							) A  ORDER BY sendTotal DESC
							
#\ub3c4\uba54\uc778 \uc2e4\ud328 \ud1b5\uacc4				
massmail.statistic.faildomain = SELECT TOP 20 lower(domainName) AS domainName, (SELECT SUM(sendTotal) FROM tm_massmail_domainstatistic WHERE massmailID=:massmailID AND scheduleID=:scheduleID AND domainName = F.domainName) sendCount, SUM(failCount) failCount, ISNULL(SUM(CASE failcauseType WHEN 1 THEN failCount ELSE 0 END),0) failcauseType1Count, ISNULL(SUM(CASE failcauseType WHEN 2 THEN failCount ELSE 0 END),0) failcauseType2Count, \
								ISNULL(SUM(CASE failcauseType WHEN 3 THEN failCount ELSE 0 END),0) failcauseType3Count, \
								ISNULL(SUM(CASE failcauseType WHEN 4 THEN failCount ELSE 0 END),0) failcauseType4Count \
							FROM tm_massmail_failstatistic F \
							WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
							GROUP BY domainName ORDER BY failCount DESC 
#\uc2e4\ud328\uc6d0\uc778\ubcc4 \ud1b5\uacc4
massmail.statistic.failcause = SELECT failcauseTypeName, failCount, failCauseType, failcauseCodeName, failcauseCode \
							   FROM ( \
							   	      SELECT failcauseTypeName, ISNULL(SUM(failCount), 0) failcount, A.failCauseType, failcauseCodeName, A.failcauseCode \
							   	      FROM tm_smtp_failtype  A left outer join tm_massmail_failstatistic B ON A.failcauseCode = B.failcauseCode \
							   	      AND massmailID=:massmailID AND scheduleID=:scheduleID \
							   	      GROUP BY A.failcauseCode, failcauseTypeName, A.failCauseType , failcauseCodeName \
							   ) C

#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 -\ub9c1\ud06c
massmail.statistic.personpreviewlink = SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY registDate desc) AS RN, email, registDate, count(email) as smtpCode, '' as smtpMsg  \
                                       FROM tm_massmail_linkclick \
                                       WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                       AND linkID =:key GROUP BY email, registDate
#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 -\ub9c1\ud06c \ub300\uc0c1\uc790 \uc218 
massmail.statistic.personpreviewlinktotal = SELECT count(DISTINCT email)  \
                                       FROM tm_massmail_linkclick \
                                       WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                       AND linkID =:key
#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 -\ud544\ud130\ub300\uc0c1\uc790
massmail.statistic.personpreviewfilter = SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY registDate) AS RN, email, registDate, '' as smtpCode, '' as smtpMsg  FROM
#\ub300\uc0c1\uc790  \ubbf8\ub9ac\ubcf4\uae30 
massmail.statistic.personpreviewselect = SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY registDate) AS RN, email, registDate, openDate, smtpCode, smtpMsg, onetooneInfo FROM
massmail.statistic.personpreviewcount = SELECT count(*) FROM
massmail.statistic.personpreviewtotal = WHERE massmailID=:massmailID AND scheduleID=:scheduleID 
                                              
massmail.statistic.personpreviewsuccess = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                          AND smtpCodeType=0 
                                              
massmail.statistic.personpreviewfail = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                       AND smtpCodeType > 0 
                                              
massmail.statistic.personpreviewopen = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                       AND openYN='Y' 
                                          
                                              
massmail.statistic.personpreviewclick = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                        AND clickYN='Y' 
                                                                                          
massmail.statistic.personpreviewrejectcall =  WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                             AND rejectcallYN='Y' 

#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 -\uc2dc\uac04\ubcc4
massmail.statistic.personpreviewhourlytotal = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND datename(hh, registDate)=:key
                                              
massmail.statistic.personpreviewhourlysuccess = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType=0 \
                                              AND datename(hh,registDate)=:key
                                              
massmail.statistic.personpreviewhourlyfail = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType > 0 \
                                              AND datename(hh,registDate)=:key
                                              
massmail.statistic.personpreviewhourlyopen =  WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND openYN='Y'
#AND datename(hh,registDate)=:key
                                              
massmail.statistic.personpreviewhourlyclick = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND clickYN='Y' \
                                              AND datename(hh,registDate)=:key
                                              
massmail.statistic.personpreviewhourlyrejectcall = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND rejectcallYN='Y' \
                                              AND datename(hh,registDate)=:key
                                              
#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 -\uc77c\uc790\ubcc4                                             
massmail.statistic.personpreviewdailytotal =  WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND datename(dd, registDate)=:key
                                              
massmail.statistic.personpreviewdailysuccess = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType=0 \
                                              AND datename(dd, registDate)=:key
                                              
massmail.statistic.personpreviewdailyfail = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType > 0 \
                                              AND datename(dd, registDate)=:key
                                              
massmail.statistic.personpreviewdailyopen = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND openYN='Y'
#AND datename(dd, registDate)=:key
                                              
massmail.statistic.personpreviewdailyclick = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND clickYN='Y' \
                                              AND datename(dd, registDate)=:key
                                              
massmail.statistic.personpreviewdailyrejectcall = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND rejectcallYN='Y' \
                                              AND datename(dd, registDate)=:key

#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 -\ub3c4\uba54\uc778                                             
massmail.statistic.personpreviewdomaintotal = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND domainName=:key
                                              
massmail.statistic.personpreviewdomainsuccess = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType=0 \
                                              AND domainName=:key
                                              
massmail.statistic.personpreviewdomainfail =WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType > 0 \
                                              AND domainName=:key
                                              
massmail.statistic.personpreviewdomainopen = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND openYN='Y' \
                                              AND domainName=:key
                                              
massmail.statistic.personpreviewdomainclick = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND clickYN='Y' \
                                              AND domainName=:key
                                              
massmail.statistic.personpreviewdomainrejectcall =  WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND rejectcallYN='Y' \
                                              AND domainName=:key
#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 -\uc2e4\ud328\ub3c4\uba54\uc778   

massmail.statistic.personpreviewfaildomaintype1 = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType = 1 \
                                              AND domainName=:key

massmail.statistic.personpreviewfaildomaintype2 = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType = 2 \
                                              AND domainName=:key

massmail.statistic.personpreviewfaildomaintype3 = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType = 3 \
                                              AND domainName=:key

massmail.statistic.personpreviewfaildomaintype4 = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType = 4 \
                                              AND domainName=:key

massmail.statistic.personpreviewfaildomaintype5 = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                              AND smtpCodeType = 5 \
                                              AND domainName=:key
#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 -\uc2e4\ud328\uc6d0\uc778\ubcc4
massmail.statistic.personpreviewfailcause = WHERE massmailID=:massmailID AND scheduleID=:scheduleID \
                                           AND failCauseCode=:key
                                                                                           
massmail.statistic.personpreview.tail =\ ) AS A  WHERE RN BETWEEN :start+1  AND :count+:start



#\uc785\ub825\uc815\ubcf4\ubcf4\uae30
massmail.statistic.basicinfo=SELECT i.massmailTitle, i.sendType, i.statisticsOpenType, ISNULL(CONVERT(varchar,i.registDate, 120),'-') registDate, m.mailLinkYN, u.userName,  \
						m.mailTitle, m.senderMail, m.senderName, m.returnMail,  \
						ISNULL(CONVERT(varchar,s.sendScheduleDate, 120),'-') sendScheduleDate, ISNULL(CONVERT(varchar,s.statisticsEndDate, 120),'-') statisticsEndDate, ISNULL(CONVERT(varchar,s.prepareStartTime, 120),'-') prepareStartTime, \
						ISNULL(CONVERT(varchar,s.prepareEndTime, 120),'-') prepareEndTime, ISNULL(CONVERT(varchar,s.sendStartTime, 120),'-') sendStartTime, ISNULL(CONVERT(varchar,s.sendEndTime, 120),'-') sendEndTime, s.retryCount, \
						ISNULL(CONVERT(varchar,s.retryStartTime, 120),'-') retryStartTime, ISNULL(CONVERT(varchar,s.retryEndTime, 120),'-') retryEndTime, s.state, s.retryFinishYN, s.backupYearMonth, s.sendTotalCount, m.mailContent, \
						f.sendedType, f.sendedYear, f.sendedMonth, f.sendedCount, f.rejectType, f.persistErrorCount, s.targetTotalCount \
						FROM tm_massmail_info i INNER JOIN tm_users u ON i.approveUserID=u.userID \
						INNER JOIN tm_massmail_schedule s ON i.massmailID=s.massmailID \
						INNER JOIN tm_massmail_mail m ON i.massmailID=m.massmailID \
						INNER JOIN tm_massmail_filterset f ON i.massmailID=f.massmailID  WHERE i.massmailID=:massmailID AND s.scheduleID=:scheduleID						
massmail.statistic.sendinfo=SELECT ISNULL(SUM(sendTotal),0) as sendTotal, \
								ISNULL(SUM(successTotal),0) as successTotal, \
								ISNULL(SUM(failTotal),0) as failTotal, \
								ISNULL(SUM(openTotal),0) as openTotal, \
								ISNULL(SUM(clickTotal),0) as clickTotal, \
								ISNULL(SUM(rejectcallTotal),0) as  rejectcallTotal \
								FROM tm_massmail_domainstatistic \
								WHERE massmailID=:massmailID AND scheduleID=:scheduleID 
massmail.statistic.filterinfo=SELECT ISNULL(SUM(CASE filterType WHEN 0 THEN filterCount END),0) filterType0, \
								ISNULL(SUM(CASE filterType WHEN 1 THEN filterCount END),0) filterType1, \
								ISNULL(SUM(CASE filterType WHEN 2 THEN filterCount END),0) filterType2, \
								ISNULL(SUM(CASE filterType WHEN 3 THEN filterCount END),0) filterType3, \
								ISNULL(SUM(CASE filterType WHEN 4 THEN filterCount END),0) filterType4, \
								ISNULL(SUM(CASE filterType WHEN 5 THEN filterCount END),0) filterType5, \
								ISNULL(SUM(CASE filterType WHEN 6 THEN filterCount END),0) filterType6, \
								ISNULL(SUM(CASE filterType WHEN 7 THEN filterCount END),0) filterType7, \
								ISNULL(SUM(filterCount),0) filterTotal \
								FROM tm_massmail_filterstatistic \
                             	WHERE massmailID=:massmailID AND scheduleID=:scheduleID 
massmail.reportmonth.totalinfo=SELECT  count(scheduleID) totalCount, \
									count(CASE state WHEN 00 THEN 1 END) writeCount, \
									count(CASE state WHEN 10 THEN 1 END) appReadyCount, \
									count(CASE state WHEN 11 THEN 1 WHEN 12 THEN 1 WHEN 13 THEN 1 END) readyCount, \
									count(CASE state WHEN 14 THEN 1  WHEN 16 THEN 1 END) sendingCount, \
									count(CASE state WHEN 15 THEN 1 END) sendFinishCount, \
									count(CASE state WHEN 22 THEN 1 WHEN 24 THEN 1 WHEN 26 THEN 1 END) errCount, \
									count(CASE state WHEN 32 THEN 1 WHEN 34 THEN 1 WHEN 44 THEN 1 END) sendingStopCount \
						       FROM tm_massmail_schedule S INNER JOIN tm_massmail_info I ON S.massmailID = I.massMailID INNER JOIN tm_users U ON I.userID = U.userID  \
						       WHERE S.deleteYN='N' AND sendScheduleDate >= :fromDate AND sendScheduleDate <= :toDate 
massmail.reportmonth.where=sendScheduleDate >= :fromDate AND sendScheduleDate <= :toDate 
massmail.reportmonth.sendinfo=SELECT ISNULL(SUM(sendTotal),0) sendTotal, \
									 ISNULL(SUM(successTotal),0) successTotal, \
									 ISNULL(SUM(failTotal),0) failTotal, \
									 ISNULL(SUM(openTotal),0) openTotal, \
									 ISNULL(SUM(clickTotal),0) clickTotal, \
									 ISNULL(SUM(rejectcallTotal ),0) rejectcallTotal \
									 FROM tm_massmail_domainstatistic D INNER JOIN tm_massmail_schedule S ON D.massmailID = S.massmailID AND D.scheduleID = S.scheduleID INNER JOIN tm_massmail_info I ON  S.massmailID = I.massMailID INNER JOIN tm_users U ON I.userID = U.userID \
									 WHERE S.deleteYN='N' AND sendScheduleDate >= :fromDate AND sendScheduleDate <= :toDate 		 
massmail.reportmonth.domainsendinfo=SELECT TOP 10 domainName, ISNULL(SUM(sendTotal),0) sendTotal, \
									 ISNULL(SUM(successTotal),0) successTotal, \
									 ISNULL(SUM(failTotal),0) failTotal, \
									 ISNULL(SUM(openTotal),0) openTotal, \
									 ISNULL(SUM(clickTotal),0) clickTotal, \
									 ISNULL(SUM(rejectcallTotal ),0) rejectcallTotal \
									 FROM tm_massmail_domainstatistic A, tm_massmail_schedule B, tm_massmail_info C  \
									 WHERE B.deleteYN='N' AND A.massmailID = B.massMailID AND A.scheduleID = B.scheduleID AND A.massmailID = C.massMailID \
									 AND sendScheduleDate >= :fromDate AND sendScheduleDate <= :toDate 
massmail.reportmonth.domainsendinfogroupby=GROUP BY domainName ORDER BY ISNULL(SUM(sendTotal),0) DESC 
massmail.reportmonth.timesendinfo=SELECT hourDate, sendCount, successCount, failCount, openCount, clickCount, rejectcallCount, CASE successCount WHEN 0 THEN 0 ELSE (successCount / sendCount) * 100 END successRatio \
									FROM ( \
										SELECT hourDate, SUM(sendCount) sendCount,  SUM(successCount) successCount, SUM(failCount) failCount, SUM(openCount) openCount, SUM(clickCount) clickCount, SUM(rejectcallCount) rejectcallCount \
										FROM tm_massmail_timestatistic A, tm_massmail_info B,  tm_massmail_schedule S \
										WHERE A.massmailID = B.massMailID AND  A.massmailID = S.massMailID AND  A.scheduleID = S.scheduleID AND S.deleteYN='N' AND sendScheduleDate >= :fromDate AND sendScheduleDate <= :toDate 
massmail.reportmonth.timesendinfogroupby=GROUP BY hourDate ) C
massmail.statistic.usersselect=SELECT C.userID, D.userName, E.groupName, ISNULL(SUM(sendTotal),0) sendTotal, \
								ISNULL(SUM(successTotal),0) successTotal, \
								ISNULL(SUM(failTotal),0) failTotal, \
								ISNULL(SUM(openTotal),0) openTotal, \
								ISNULL(SUM(clickTotal),0) clickTotal, \
								ISNULL(SUM(rejectcallTotal ),0) rejectcallTotal \
								FROM tm_massmail_domainstatistic A \
								INNER JOIN tm_massmail_schedule B ON A.massmailID = B.massMailID AND  A.scheduleID = B.scheduleID \
								INNER JOIN tm_massmail_info C ON A.massmailID = C.massMailID \
								INNER JOIN tm_users D ON C.userID = D.userID \
								INNER JOIN tm_usergroup E ON E.groupID=D.groupID WHERE B.deleteYN='N' AND datename(yy,sendScheduleDate)=:year AND datename(mm, sendScheduleDate)=:month					 
													
massmail.statistic.groupselect=SELECT g.groupID, g.groupName, 
massmail.statistic.usersselectfield= SUM(CASE WHEN r.wasSended='O' THEN 1 ELSE 0 END) AS sendTotal ,  \
						SUM(CASE WHEN r.smtpCodeType='0' THEN 1 ELSE 0 END) AS successTotal, 	 \
						SUM(CASE WHEN r.smtpCodeType<>'0' THEN 1 ELSE 0 END) AS failTotal,  \
						SUM(CASE WHEN r.openYN='Y' THEN 1 ELSE 0 END) AS openTotal,  \
						SUM(CASE WHEN r.clickYN='Y' THEN 1 ELSE 0 END) AS clickTotal,  \
						SUM(CASE WHEN r.rejectcallYN='Y' THEN 1 ELSE 0 END) AS rejectcallTotal 		
massmail.statistic.usersgroupby= GROUP BY C.userID, D.userName, E.groupName \ 
massmail.statistic.groupgroupby=GROUP BY g.groupID, g.groupName ORDER BY g.groupName

massmail.statistic.concerneddomain=SELECT lower(domainName) AS domainName, sendTotal, successTotal, failTotal, convert(int,(convert(float,successTotal) / sendTotal)*100) successRatio  \
										FROM ( \
										SELECT  domainName, ISNULL(SUM(sendTotal),0) sendTotal, \
										ISNULL(SUM(successTotal),0) successTotal, \
										ISNULL(SUM(failTotal),0) failTotal \
										FROM tm_massmail_domainstatistic S, \
										(select top 3 F.massmailID from (SELECT massmailID FROM tm_massmail_schedule where deleteYN='N' GROUP BY massmailID  ) F order by F.massmailID desc ) I \
										WHERE S.massmailID = I.massMailID \
										GROUP BY domainName  \
								   )A \
								   WHERE A.domainName IN(SELECT domainName FROM tm_domainconfig WHERE domainType=2)						
#\ubc1c\uc1a1\uc2a4\ucf00\uc974
massmail.schedule.schedulelist=select s.massmailID, s.scheduleID, i.massmailTitle, i.userID, s.sendScheduleDate, g.groupID, u.userName, u.userLevel, i.description, i.sendType, s.state, s.targetTotalCount \
					from tm_massmail_schedule s INNER JOIN tm_massmail_info i on s.massmailID = i.massmailID \
					INNER JOIN tm_users u on i.userID=u.userID \
					INNER JOIN tm_usergroup g on u.groupID=g.groupID \
					WHERE s.deleteYN='N' AND CONVERT(varchar, s.sendScheduleDate, 121) like :yyyy_mm \
					
massmail.schedule.viewSchedule=select s.MassMailID, s.ScheduleID, i.MassMailTitle, i.UserID, s.SendScheduleDate, u.UserName, u.UserLevel, u.groupID, i.description, i.sendType, s.state, s.targetTotalCount, i.statisticsOpenType \
					from tm_massmail_schedule s INNER JOIN tm_massmail_info i on s.massmailID = i.massmailID \
					INNER JOIN tm_users u on i.userID=u.userID \
					WHERE s.massmailID = :massmailID and s.scheduleID = :scheduleID 
					
massmail.schedule.schedule.tail=order by s.sendScheduleDate 

massmail.write.selectmassmailmtate=SELECT sendTotalCount, state, (SELECT ISNULL(SUM(successTotal),-1) FROM tm_massmail_domainstatistic d WHERE s.massmailID = d.massmailID AND s.scheduleID = d.scheduleID) as successTotal from tm_massmail_schedule s WHERE s.scheduleID = :scheduleID and s.massmailID = :massmailID 
massmail.write.getuserinfo=SELECT userName, email FROM tm_users u WHERE u.userID = :userID
massmail.write.backupdate=SELECT backupYearMonth FROM tm_massmail_backupdate

massmail.statistic.updateretryfinishYN=UPDATE tm_massmail_schedule SET retryFinishYN='N', updateStatisticYN='Y', retryManual='Y' WHERE massmailID = :massmailID and scheduleID = :scheduleID 
massmail.statistic.updateretrysended=SET wasRetrySended ='X' WHERE failCauseCode = :failCauseCode
massmail.statistic.updateretrysendeddomain=SET wasRetrySended ='X' WHERE domainName = :domainName	AND  smtpCodeType IN(1,3) 
massmail.statistic.updateretrysendedpoll=SET retryPollYN='Y' WHERE sendID NOT IN \
                                         (select sendID FROM TM_POLL_ANSWER \
                                         WHERE massmailID=:massmailID AND scheduleID=:scheduleID) AND smtpCodeType IN('0','1','3','4') AND rejectcallYN='N'
#\uc124\ubb38\ud1b5\uacc4
massmail.statistic.selectPollStatistic=SELECT q.pollID, q.questionID, q.questionNo, q.questionText, q.questionType, q.requiredYN, q.exampleType, q.exampleGubun, q.exampleMultiCount ,e.exampleID, e.exampleDesc \
						,(SELECT COUNT(*) FROM tm_poll_answer a WHERE a.pollID=q.pollID AND a.questionID=q.questionID AND a.exampleID=e.exampleID AND a.massmailID=:massmailID AND a.scheduleID=:scheduleID) responseCount \
						,(SELECT COUNT(*) FROM tm_poll_answer a WHERE a.pollID=q.pollID AND a.questionID=q.questionID  AND a.massmailID=:massmailID AND a.scheduleID=:scheduleID) questionCount \
						FROM tm_poll_question q LEFT OUTER JOIN tm_poll_example e ON q.pollID=e.pollID AND q.questionID=e.questionID WHERE q.pollID=:pollID ORDER BY q.questionNo 
massmail.statistic.getPollIDByMassMail=SELECT pollID FROM tm_massmail_mail WHERE massmailID=:massmailID
massmail.statistic.massmailPollPreview=SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY registDate desc) AS RN, email, responseText, registDate FROM tm_poll_answer WHERE pollID=:pollID AND massmailID=:massmailID AND scheduleID=:scheduleID AND questionID=:questionID AND exampleID=:exampleID AND matrixX=:matrixX AND matrixY=:matrixY AND ranking=:ranking
massmail.statistic.massmailPollPreviewTail=\ ) AS A  WHERE RN BETWEEN :start+1  AND :count+:start
massmail.statistic.massmailPollPreviewTotalCount=SELECT COUNT(*) FROM tm_poll_answer WHERE pollID=:pollID AND massmailID=:massmailID AND scheduleID=:scheduleID AND questionID=:questionID AND exampleID=:exampleID AND matrixX=:matrixX AND matrixY=:matrixY AND ranking=:ranking

#\uc124\ubb38 \ucc28\ud2b8\ud1b5\uacc4\uc6a9  SELECT (SELECT COUNT(*) FROM tm_massmail_sendresult_27_1) sendTotalCnt,
massmail.statistic.massmailPollStatisticCount=COUNT(DISTINCT(sendID)) responseCount FROM tm_poll_answer a WHERE a.massmailID=:massmailID AND a.scheduleID=:scheduleID AND a.pollID=:pollID 

#API
massmail.api.getonetooneid=select onetooneid from tm_onetoone where onetooneAlias = :onetooneAlias 
massmail.api.gettargetstate=select state from tm_target_list where targetID = :targetID
massmail.api.gettemplatecontent=select templateContent from tm_massmail_templates where templateID = :templateID

massmail.statistic.massmailPollAllResponse=SELECT * FROM ( SELECT ROW_NUMBER() OVER(ORDER BY B.registDate desc) AS RN, B.* FROM (	SELECT sendID, email, convert(varchar, registDate, 20) as registDate FROM tm_poll_answer WHERE massmailID=:massmailID AND scheduleID=:scheduleID AND pollID=:pollID	GROUP BY sendID, email, convert(varchar, registDate, 20)) as B 
massmail.statistic.massmailPollAllResponseTail=\ ) AS A  WHERE RN BETWEEN :start+1  AND :count+:start
massmail.statistic.massmailPollAllResponseTotalCount=SELECT COUNT(DISTINCT(email)) FROM tm_poll_answer WHERE massmailID=:massmailID AND scheduleID=:scheduleID AND pollID=:pollID

#\uc124\ubb38\uc751\ub2f5\uc0c1\uc138\ubcf4\uae30 
massmail.statistic.viewDetailAnswer=SELECT q.pollID, q.questionID, q.questionNo, q.questionText, q.questionType, q.requiredYN, q.exampleType, q.exampleGubun, q.exampleMultiCount ,e.exampleID , e.exampleDesc, a.exampleID responseExampleID, a.responseText \
							FROM tm_poll_question q LEFT OUTER JOIN tm_poll_example e ON q.pollID=e.pollID AND q.questionID=e.questionID \
							LEFT OUTER JOIN tm_poll_answer a ON q.pollID=a.pollID AND q.questionID=a.questionID WHERE q.pollID=:pollID AND a.massmailID=:massmailID AND a.scheduleID=:scheduleID AND a.sendID=:sendID AND a.matrixX=:matrixX AND a.matrixY=:matrixY ORDER BY q.questionNo 
massmail.statistic.selectQuestionByPollID=SELECT pollID, questionID, questionNo, questionType, questionText, exampleType, exampleGubun, exampleMultiCount, requiredYN FROM tm_poll_question WHERE pollID=:pollID ORDER BY questionNo

massmail.statistic.selectPollStatisticByQuestionID=SELECT e.exampleID, e.exampleDesc, e.exampleExYN  , SUM(CASE WHEN a.exampleID=e.exampleID THEN 1 ELSE 0 END) responseCount FROM tm_poll_example e LEFT OUTER JOIN tm_poll_answer a \
								ON e.pollID=a.pollID AND e.questionID=a.questionID  WHERE a.massmailID=:massmailID AND a.scheduleID=:scheduleID AND a.pollID=:pollID AND a.questionID=:questionID \
								GROUP BY e.exampleID, e.exampleDesc, e.exampleExYN ORDER BY e.exampleID
massmail.statistic.selectPollExampleMatrixY=SELECT exampleID, exampleDesc FROM tm_poll_example WHERE pollID=:pollID AND questionID=:questionID AND matrixXY='Y'
massmail.statistic.viewQuestion=SELECT questionNo, questionID, questionType, questionText FROM tm_poll_question WHERE pollID=:pollID AND questionID=:questionID


#\uba54\uc77c \ud544\ud130
massmail.write.selectmassmailfilter=select filterType, content, contentType, filterLevel from tm_filter_manger where filterLevel != 3 
 
massmail.statistic.selectPollIndividualStatisticSelect=select A.email, B.questionText,A.questionID, A.exampleID, matrixX, matrixY, B.questionType, C.exampleDesc+'    '+ISNULL(responseText,'') as exampleDesc_responseText, exampleDesc, responseText, D.onetooneInfo, B.exampleType \
												FROM tm_poll_answer A, tm_poll_question B , tm_poll_example C  
massmail.statistic.selectPollIndividualStatisticWhere=WHERE A.questionID= B.questionID  AND A.pollID = C.pollID AND A.questionID= C.questionID AND A.massmailID = D.massmailID AND A.scheduleID = D.scheduleID AND A.email = D.email \
												AND A.pollID = B.pollID \
												AND ((C.matrixXY='Y' AND A.matrixY = C.exampleID) OR (matrixX=0 AND A.exampleID = C.exampleID)) \
												AND A.massmailID=:massmailID AND A.scheduleID=:scheduleID 
massmail.statistic.updateretrysendedpoll=SET retryPollYN='Y' WHERE sendID NOT IN \
                                         (select sendID FROM TM_POLL_ANSWER \
                                         WHERE massmailID=:massmailID AND scheduleID=:scheduleID) AND smtpCodeType IN('0','1','3','4') AND rejectcallYN='N'
                                         
#\ub300\uc0c1\uc790 \ubbf8\ub9ac\ubcf4\uae30 - \uc77c\ub300\uc77c \ud544\ub4dc \ucd94\uac00
massmail.statistic.selectonetoone=SELECT o.onetooneName, o.onetooneAlias FROM tm_onetoone o INNER JOIN tm_onetoone_target t ON o.onetooneID=t.onetooneID INNER JOIN tm_massmail_targetgroup m ON m.targetID=t.targetID where o.onetooneID!=1 and m.massmailID=:massmailID and m.exceptYN = 'N'
massmail.statistic.targetids=select targetID from tm_massmail_targetgroup where massmailID = :massmailID and exceptYN = 'N'

#\uc6b0\uc120\uc21c\uc704 \uad00\ub9ac
massmail.write.getMassMailList=SELECT ROW_NUMBER() OVER(ORDER BY s.priority, s.sendScheduleDate) rn, s.massmailID, s.scheduleID, s.priority, m.massmailTitle, m.sendType, s.sendScheduleDate, s.targetTotalCount, s.sendTotalCount, s.state \
								FROM tm_massmail_info m, tm_massmail_schedule s where m.massmailID = s.massmailID \
								AND s.deleteYN='N' AND s.state in ('13','14','45') AND s.sendScheduleDate <= getDate() 
massmail.write.updatepriority=update tm_massmail_schedule set priority = :priority where massmailID = :massmailID and scheduleID =:scheduleID		

#\uc124\ubb38 \uc804\uccb4 \ubbf8\uc751\ub2f5\uc790
massmail.statistic.massmailPollAllNotResponse=WHERE massmailID=:massmailID AND sendID NOT IN (SELECT DISTINCT sendID FROM tm_poll_answer WHERE massmailID=:massmailID)
massmail.statistic.massmailPollAllNotResponseTail= ) AS A  WHERE RN BETWEEN :start+1  AND :count+:start
massmail.statistic.massmailPollAllNotResponseTotalCount=WHERE massmailID = :massmailID AND sendID NOT IN (SELECT DISTINCT sendID FROM tm_poll_answer WHERE massmailID=:massmailID)

#\ubc1c\uc1a1\uacb0\uacfc\ub9ac\uc2a4\ud2b8 - \uc124\ubb38\ud1b5\uacc4( \ud574\ub2f9 \uba54\uc77c\uc5d0 \uc0ac\uc6a9 \ub41c \uc124\ubb38\uc758 \uc885\ub8cc\uae30\uc900, \ubaa9\ud45c\uc751\ub2f5\uc218, \uc124\ubb38\ub9c8\uac10\uc77c \ud45c\uc2dc)
massmail.statistic.selectPollInfo=SELECT SUBSTRING(convert(varchar,pollEndDate,23),1,10) pollEndDate, pollendType, aimAnswerCnt FROM tm_poll_info WHERE pollID=:pollID

#\uc124\ubb38\uc870\uc0ac \uc81c\ubaa9 
massmail.statistic.pollTitle=SELECT pollTitle FROM tm_poll_info WHERE pollID =:pollID
#\ubb38\ud56d\ub2f9 \ubcf4\uae30 \uac2f\uc218 
massmail.statistic.exampleCount=SELECT COUNT(exampleID) FROM tm_poll_example WHERE pollID = :pollID AND questionID = :questionID
#\ubb38\ud56d\ub2f9 \ubcf4\uae30 \ub0b4\uc6a9 
massmail.statistic.exampleDesc=SELECT exampleDesc FROM tm_poll_example WHERE pollID=15 AND questionID=1 AND exampleID=3
#\uc8fc\uad00\uc2dd \uc751\ub2f5 \ub2f5\uc548 \ubaa9\ub85d
massmail.statistic.responseTextAll=SELECT responseText FROM tm_poll_answer WHERE pollID=:pollID AND massmailID=:massmailID AND scheduleID=:scheduleID AND questionID=:questionID AND responseText != ''

#\uac1d\uad00\uc2dd \ubb38\ud56d  \uc8fc\uad00\uc2dd \ub2f5\uc548 \uac2f\uc218(\ubb38\uc81c\ub9c8\ub2e4 \ud3ec\ud568\ub41c \uac2f\uc218)
massmail.statistic.exampleExYNcount=SELECT COUNT(exampleExYN) exampleExYNcount FROM tm_poll_example WHERE pollID = :pollID AND questionID=:questionID AND exampleExYN='Y'
#\uac1d\uad00\uc2dd \ubb38\ud56d  \uc8fc\uad00\uc2dd \ub2f5\uc548 \uac2f\uc218(\uc124\ubb38\ub0b4\uc5d0 \ud3ec\ud568\ub41c \uac2f\uc218)
massmail.statistic.pollExampleExYNcount=SELECT COUNT(exampleExYN) exampleExYNcount FROM tm_poll_example WHERE pollID = :pollID AND exampleExYN='Y'
#\uc124\ubb38 \ub0b4 \uc8fc\uad00\uc2dd \ubb38\ud56d \uac2f \uc218
massmail.statistic.exampleTypeCount=SELECT COUNT(exampleType) exampleTypeCount FROM tm_poll_question WHERE pollID = :pollID AND exampleType='2'
#\uc124\ubb38 \ub0b4 \ubcf4\uae30 \uac2f \uc218(\uc140 \ucd1d \uac2f \uc218 - \uc5ec\ubc31\uc124\uc815\uc744 \uc704\ud55c \uce74\uc6b4\ud2b8)
massmail.statistic.exampleAllCount=SELECT COUNT(exampleID) FROM tm_poll_example WHERE pollID=:pollID

#\ubc1c\uc1a1\uacb0\uacfc\ub9ac\uc2a4\ud2b8 - \uc0c1\ud0dc \uac12 \ubcc0\uacbd\uc2dc \ube44\uad50\ud560 \ud604\uc7ac DB \uc0c1\ud0dc \uac12 \ucd94\ucd9c
massmail.write.getMassMailState=SELECT state FROM tm_massmail_schedule WHERE massmailID=:massmailID AND scheduleID=:scheduleID
#\uc218\uc2e0\uac70\ubd80 \ub9c1\ud06c \ub9ac\uc2a4\ud2b8
massmail.write.selectMailRejcetLink=SELECT linkID, massmailID, linkName, linkURL, linkCount, linkDesc, linkType FROM tm_massmail_link WHERE massmailID=:massmailID AND linkType='2'